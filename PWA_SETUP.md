# PWA Configuration Guide

This application has been configured as a Progressive Web App (PWA) using `vite-plugin-pwa`.

## Features

### âœ… Installed Features

- **Offline Support**: Service worker with Workbox for offline functionality
- **Auto Updates**: Automatic service worker updates with user prompt
- **Web App Manifest**: Configured for installation on mobile and desktop
- **Font Caching**: Bunny Fonts cached for offline use
- **Asset Caching**: Static assets (JS, CSS, images) cached automatically
- **Dev Mode PWA**: PWA features enabled in development for testing

### ðŸŽ¯ Key Components

1. **Service Worker**: Auto-generated by Vite PWA plugin
2. **Web Manifest**: Generated at `/manifest.webmanifest`
3. **Update Prompt**: `PWAPrompt.vue` component for update notifications
4. **PWA Composable**: `usePWA.ts` for managing PWA state

## Configuration

### Vite Config ([vite.config.ts](vscode-vfs://github/mastashake08/webrtc-multicast/vite.config.ts))

```typescript
VitePWA({
    registerType: 'autoUpdate',
    includeAssets: ['favicon.ico', 'favicon.svg', 'apple-touch-icon.png'],
    manifest: {
        name: 'WebRTC Multicast',
        short_name: 'WebRTC',
        description: 'WebRTC streaming application with multicast support',
        theme_color: '#ffffff',
        background_color: '#ffffff',
        display: 'standalone',
        scope: '/',
        start_url: '/',
        icons: [...]
    },
    workbox: {
        globPatterns: ['**/*.{js,css,html,ico,png,svg,woff,woff2}'],
        runtimeCaching: [...] // Font caching configured
    },
    devOptions: {
        enabled: true, // PWA works in dev mode!
        type: 'module',
    },
})
```

### Customizing the Manifest

Edit the `manifest` object in [vite.config.ts](vscode-vfs://github/mastashake08/webrtc-multicast/vite.config.ts):

- **name**: Full application name (shown on install)
- **short_name**: Short name (shown on home screen)
- **theme_color**: Browser theme color
- **background_color**: Splash screen background
- **display**: `standalone`, `fullscreen`, `minimal-ui`, or `browser`

### Workbox Caching Strategies

The app uses these caching strategies:

1. **Precaching**: All build assets cached on install
2. **Runtime Caching**: 
   - Fonts: CacheFirst strategy (1 year expiration)
   - Add more patterns in `workbox.runtimeCaching` array

Available strategies:
- `CacheFirst`: Cache, falling back to network
- `NetworkFirst`: Network, falling back to cache
- `StaleWhileRevalidate`: Cache response while updating
- `NetworkOnly`: Network only
- `CacheOnly`: Cache only

## Usage

### Update Prompt Component

The `PWAPrompt.vue` component appears when:
- App is ready to work offline (first install)
- A new version is available

Users can:
- Click "Reload" to update to the new version
- Click "Later" or "OK" to dismiss

### PWA Composable

Use in any component:

```vue
<script setup lang="ts">
import { usePWA } from '@/composables/usePWA';

const { needRefresh, offlineReady, updateServiceWorker } = usePWA();

// Manually trigger update
const handleUpdate = () => {
    updateServiceWorker(true); // true = reload page after update
};
</script>
```

### Programmatic Service Worker Updates

The service worker checks for updates:
- On page load
- Every hour (configured in `usePWA.ts`)
- On user navigation (Inertia.js integration)

## Testing

### Development Mode

PWA is enabled in development:

```bash
npm run dev
# or
composer run dev
```

Visit your app and check:
1. **DevTools > Application > Service Workers**: Should show registered SW
2. **DevTools > Application > Manifest**: Should show manifest details
3. **DevTools > Network**: Toggle offline to test offline mode

### Production Build

```bash
npm run build
php artisan serve
```

### Testing Installation

**Chrome/Edge:**
1. Navigate to app URL
2. Click install icon in address bar
3. Or: Menu > Install [App Name]

**Mobile (iOS/Android):**
1. Open app in Safari/Chrome
2. Share menu > "Add to Home Screen"
3. App installs like native app

## Browser Support

| Feature | Chrome | Firefox | Safari | Edge |
|---------|--------|---------|--------|------|
| Service Workers | âœ… | âœ… | âœ… | âœ… |
| Web Manifest | âœ… | âœ… | âš ï¸ Limited | âœ… |
| Install Prompt | âœ… | âŒ | âš ï¸ iOS only | âœ… |
| Push Notifications | âœ… | âœ… | âŒ | âœ… |

## Required Assets

âš ï¸ **Important**: Add these icons to `/public`:
- `pwa-192x192.png` (192x192px)
- `pwa-512x512.png` (512x512px)

See [public/PWA_ICONS_README.md](vscode-vfs://github/mastashake08/webrtc-multicast/public/PWA_ICONS_README.md) for icon generation guide.

## Advanced Configuration

### Add Push Notifications

Install additional dependencies:

```bash
npm install web-push
```

Update `vite.config.ts`:

```typescript
VitePWA({
    // ... existing config
    workbox: {
        // ... existing config
        navigateFallback: '/index.html',
        navigateFallbackDenylist: [/^\/api/],
    }
})
```

### Customize Update Behavior

Edit [resources/js/composables/usePWA.ts](vscode-vfs://github/mastashake08/webrtc-multicast/resources/js/composables/usePWA.ts):

```typescript
useRegisterSW({
    immediate: true,
    onRegistered(registration) {
        // Change update check interval (default: 1 hour)
        setInterval(() => {
            registration.update();
        }, 30 * 60 * 1000); // 30 minutes
    },
})
```

### Disable Auto-Update

Change `registerType` in vite.config.ts:

```typescript
VitePWA({
    registerType: 'prompt', // User must manually approve updates
    // ... rest of config
})
```

### Add Offline Page

Create `public/offline.html` and configure Workbox:

```typescript
workbox: {
    navigateFallback: '/offline.html',
    navigateFallbackDenylist: [/^\/api/],
}
```

## Troubleshooting

### Service Worker Not Updating

1. Clear browser cache
2. Unregister old service worker: DevTools > Application > Service Workers > Unregister
3. Hard reload: Ctrl+Shift+R (Windows) / Cmd+Shift+R (Mac)

### PWA Not Installable

Check:
1. âœ… HTTPS enabled (required for PWA)
2. âœ… Icons present in `/public`
3. âœ… Manifest generated at `/manifest.webmanifest`
4. âœ… Service worker registered

### Build Errors

If you see virtual module errors:

```bash
# Clean install
rm -rf node_modules package-lock.json
npm install

# Rebuild
npm run build
```

## Resources

- [Vite PWA Plugin Documentation](https://vite-pwa-org.netlify.app/)
- [Workbox Documentation](https://developer.chrome.com/docs/workbox/)
- [Web App Manifest Spec](https://www.w3.org/TR/appmanifest/)
- [Service Worker API](https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API)

## Next Steps

1. âœ… Add PWA icon files (see [public/PWA_ICONS_README.md](vscode-vfs://github/mastashake08/webrtc-multicast/public/PWA_ICONS_README.md))
2. ðŸŽ¨ Customize manifest colors and app name
3. ðŸ“± Test installation on mobile devices
4. ðŸ”” Consider adding push notifications (optional)
5. ðŸ“Š Track PWA installs with analytics

---

**Status**: âœ… PWA configured and ready to use!
**Missing**: PWA icon files (see [icon guide](vscode-vfs://github/mastashake08/webrtc-multicast/public/PWA_ICONS_README.md))
